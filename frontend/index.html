<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Gestor GCMBH</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="p-4">
    <h1 class="text-2xl font-bold mb-4">Painel Gestor - GCMBH</h1>
    <div id="map" class="w-full h-[60vh] rounded-lg shadow"></div>
    <div id="erro" class="text-red-500 mt-2"></div>

    <div class="mt-6">
      <h2 class="text-xl font-semibold mb-2">‚úîÔ∏è Locais Visitados</h2>
      <ul id="listaVisitados" class="list-disc list-inside text-green-700"></ul>
    </div>

    <div class="mt-6">
      <h2 class="text-xl font-semibold mb-2">üìç Pontos Ainda N√£o Visitados</h2>
      <ul id="listaNaoVisitados" class="list-disc list-inside text-gray-700"></ul>
    </div>
  </div>

  <script>
    const tipoCor = {
      "Sa√∫de": "blue",
      "Escola": "red",
      "Pra√ßa": "yellow"
    };

    const pontosFixos = [
      { nome: "Centro de Sa√∫de Alameda dos Ip√™s", tipo: "Sa√∫de", lat: -19.791926, lng: -43.961256 },
      { nome: "Centro de Sa√∫de Andradas", tipo: "Sa√∫de", lat: -19.829681, lng: -43.955905 },
      { nome: "Centro de Sa√∫de C√©u Azul", tipo: "Sa√∫de", lat: -19.815871, lng: -44.017108 },
      { nome: "Centro de Sa√∫de Copacabana", tipo: "Sa√∫de", lat: -19.806460, lng: -44.015060 },
      { nome: "Centro de Sa√∫de Jardim Comerci√°rios", tipo: "Sa√∫de", lat: -19.811635, lng: -43.956050 },
      { nome: "Centro de Sa√∫de Jardim Comerci√°rios (anexo)", tipo: "Sa√∫de", lat: -19.810365, lng: -43.961405 },
      { nome: "Centro de Sa√∫de Jardim Europa", tipo: "Sa√∫de", lat: -19.833720, lng: -43.947929 },
      { nome: "Centro de Sa√∫de Jardim Leblon", tipo: "Sa√∫de", lat: -19.822095, lng: -43.980980 },
      { nome: "Centro de Sa√∫de Lagoa", tipo: "Sa√∫de", lat: -19.820443, lng: -44.001114 },
      { nome: "Centro de Sa√∫de Mantiqueira", tipo: "Sa√∫de", lat: -19.826858, lng: -43.987448 },
      { nome: "Centro de Sa√∫de Minas Caixa", tipo: "Sa√∫de", lat: -19.825327, lng: -43.993017 },
      { nome: "Centro de Sa√∫de Nova York", tipo: "Sa√∫de", lat: -19.803660, lng: -43.952678 },
      { nome: "Centro de Sa√∫de Para√∫na", tipo: "Sa√∫de", lat: -19.826006, lng: -43.980898 },
      { nome: "Centro de Sa√∫de Piratininga", tipo: "Sa√∫de", lat: -19.827839, lng: -43.962428 },
      { nome: "Centro de Sa√∫de Rio Branco", tipo: "Sa√∫de", lat: -19.822000, lng: -43.969600 },
      { nome: "Centro de Sa√∫de Santa M√¥nica", tipo: "Sa√∫de", lat: -19.801722, lng: -43.948917 },
      { nome: "Centro de Sa√∫de Santo Ant√¥nio", tipo: "Sa√∫de", lat: -19.824556, lng: -43.961846 },
      { nome: "Centro de Sa√∫de Serra Verde", tipo: "Sa√∫de", lat: -19.826245, lng: -43.966206 },
      { nome: "Pra√ßa Alexandrina Maria Coutinho", tipo: "Pra√ßa", lat: -19.812308, lng: -44.015534 },
      { nome: "Pra√ßa Jos√© Nogueira de S√°", tipo: "Pra√ßa", lat: -19.821955, lng: -43.970407 },
      { nome: "Pra√ßa Aminthas de Barros", tipo: "Pra√ßa", lat: -19.815558, lng: -43.974905 },
      { nome: "Pra√ßa da Rua Blumenau", tipo: "Pra√ßa", lat: -19.808052, lng: -44.017687 },
      { nome: "Pra√ßa Manoel Batista Baia", tipo: "Pra√ßa", lat: -19.826302, lng: -43.989792 },
      { nome: "Pra√ßa do Borel", tipo: "Pra√ßa", lat: -19.827525, lng: -43.993130 },
      { nome: "Pra√ßa C√©lio Silva", tipo: "Pra√ßa", lat: -19.799551, lng: -43.945551 },
      { nome: "Pra√ßa do Sapo", tipo: "Pra√ßa", lat: -19.832580, lng: -43.985994 },
      { nome: "Pra√ßa do Burac√£o", tipo: "Pra√ßa", lat: -19.832009, lng: -43.984700 },
      { nome: "Pra√ßa Rua Jos√© Maria Botelho e Rui Barbosa", tipo: "Pra√ßa", lat: -19.804126, lng: -43.942114 },
      { nome: "Pra√ßa Rua Hye Ribeiro e Maria de Lourdes Carreira", tipo: "Pra√ßa", lat: -19.805051, lng: -43.944360 },
      { nome: "Pra√ßa Rua Maria de Lourdes Carreira e Joaquim Murce Ferreira", tipo: "Pra√ßa", lat: -19.806126, lng: -43.945621 },
      { nome: "Pra√ßa Rua Maria Ant√¥nia Alves e Ot√°vio Pereira", tipo: "Pra√ßa", lat: -19.807188, lng: -43.946430 },
      { nome: "Pra√ßa Rua Bernardino de Oliveira Pena (04)", tipo: "Pra√ßa", lat: -19.808623, lng: -43.947718 },
      { nome: "Pra√ßa Rua Bernardino de Oliveira Pena (05)", tipo: "Pra√ßa", lat: -19.809003, lng: -43.947931 },
        // Inser√ß√£o dos pontos de Escola e EMEI continua abaixo
      { nome: "ESCOLA MUNICIPAL ANTONIA FERREIRA", tipo: "Escola", lat: -19.827063, lng: -43.958232 },
      { nome: "ESCOLA MUNICIPAL ANTONIO GOMES HORTA", tipo: "Escola", lat: -19.824965, lng: -43.991305 },
      { nome: "ESCOLA MUNICIPAL CORA CORALINA", tipo: "Escola", lat: -19.807519, lng: -44.013362 },
      { nome: "ESCOLA MUNICIPAL DEPUTADO RENATO AZEREDO", tipo: "Escola", lat: -19.830564, lng: -43.995772 },
      { nome: "ESCOLA MUNICIPAL DOUTOR JOSE XAVIER NOGUEIRA", tipo: "Escola", lat: -19.833111, lng: -43.948904 },
      { nome: "ESCOLA MUNICIPAL JARDIM LEBLON", tipo: "Escola", lat: -19.821633, lng: -43.979407 },
      { nome: "ESCOLA MUNICIPAL JOAQUIM DOS SANTOS", tipo: "Escola", lat: -19.815421, lng: -44.016874 },
      { nome: "ESCOLA MUNICIPAL JOSE MARIA ALKMIM", tipo: "Escola", lat: -19.827731, lng: -43.965576 },
      { nome: "ESCOLA MUNICIPAL MARIO MOURAO FILHO", tipo: "Escola", lat: -19.815682, lng: -44.017122 },
      { nome: "ESCOLA MUNICIPAL MILTON CAMPOS", tipo: "Escola", lat: -19.826124, lng: -43.988542 },
      { nome: "ESCOLA MUNICIPAL MOYSES KALIL", tipo: "Escola", lat: -19.826822, lng: -43.985331 },
      { nome: "ESCOLA MUNICIPAL PADRE MARZANO MATIAS", tipo: "Escola", lat: -19.823132, lng: -43.970995 },
      { nome: "ESCOLA MUNICIPAL PRESIDENTE TANCREDO NEVES", tipo: "Escola", lat: -19.816788, lng: -44.017506 },
      { nome: "ESCOLA MUNICIPAL PROFESSOR PEDRO GUERRA", tipo: "Escola", lat: -19.827323, lng: -43.983437 },
      { nome: "ESCOLA MUNICIPAL PROFESSOR TABAJARA PEDROSO", tipo: "Escola", lat: -19.822477, lng: -43.969194 },
      { nome: "ESCOLA MUNICIPAL VICENTE GUIMARAES", tipo: "Escola", lat: -19.810831, lng: -43.961223 },
      { nome: "ESCOLA MUNICIPAL ZILDA ARNS", tipo: "Escola", lat: -19.827891, lng: -43.962394 },
      { nome: "EMEI Alessandra Salum Cadar", tipo: "Escola", lat: -19.8226, lng: -43.9853 },
      { nome: "EMEI C√©u Azul", tipo: "Escola", lat: -19.8189, lng: -43.9902 },
      { nome: "EMEI Itamarati", tipo: "Escola", lat: -19.8291, lng: -43.9671 },
      { nome: "EMEI Jardim dos Comerci√°rios", tipo: "Escola", lat: -19.8343, lng: -43.9768 },
      { nome: "EMEI Jardim Leblon", tipo: "Escola", lat: -19.8295, lng: -43.9825 },
      { nome: "EMEI Lagoa", tipo: "Escola", lat: -19.8237, lng: -43.9912 },
      { nome: "EMEI Mantiqueira", tipo: "Escola", lat: -19.8261, lng: -43.9948 },
      { nome: "EMEI Miriam Brand√£o", tipo: "Escola", lat: -19.8302, lng: -43.9657 },
      { nome: "EMEI Navegantes", tipo: "Escola", lat: -19.8189, lng: -43.9908 },
      { nome: "EMEI Nova Iorque", tipo: "Escola", lat: -19.8361, lng: -43.9746 },
      { nome: "EMEI Para√∫nas", tipo: "Escola", lat: -19.8369, lng: -43.9700 },
      { nome: "EMEI Piratininga", tipo: "Escola", lat: -19.8310, lng: -43.9792 },
      { nome: "EMEI S√£o Jo√£o Batista", tipo: "Escola", lat: -19.8305, lng: -43.9716 },
      { nome: "EMEI Serra Verde", tipo: "Escola", lat: -19.8287, lng: -43.9624 },
      { nome: "EMEI Venda Nova", tipo: "Escola", lat: -19.8308, lng: -43.9758 },
      { nome: "EMEI Vereador Ant√¥nio Menezes", tipo: "Escola", lat: -19.8281, lng: -43.9739 },
      { nome: "EMEI Vila Apol√¥nia", tipo: "Escola", lat: -19.8283, lng: -43.9837 }
 

    ];

     const map = L.map('map').setView([-19.816, -43.980], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap'
    }).addTo(map);

    let marcadores = [];

    function atualizarMapa() {
      fetch("https://localizacao-de-rotas-proprios-production.up.railway.app/api/visitados")
        .then(res => res.json())
        .then(data => {
          marcadores.forEach(m => map.removeLayer(m));
          marcadores = [];

          document.getElementById("listaVisitados").innerHTML = "";

          data.forEach(ponto => {
            const marker = L.circleMarker([ponto.latitude, ponto.longitude], {
              color: 'green', fillOpacity: 0.6, radius: 8
            }).addTo(map);
            marker.bindPopup(`<strong>${ponto.nome}</strong><br>${ponto.tipo}<br>${ponto.viatura}`);
            marcadores.push(marker);

            const li = document.createElement("li");
            li.textContent = `${ponto.nome} (${ponto.tipo}) - ${new Date(ponto.data).toLocaleString()}`;
            document.getElementById("listaVisitados").appendChild(li);
          });
        })
        .catch(err => {
          document.getElementById('erro').textContent = 'Erro ao carregar dados da API';
          console.error(err);
        });
    }

    atualizarMapa();
    setInterval(atualizarMapa, 30000);
  </script>
</body>
</html>
